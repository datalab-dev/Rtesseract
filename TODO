Get this working on Windows.

Merge tesseractFuns.Rd

Example for GetSmudges

Check GetBoxes returns what BoundingBoxes used to.

Add an example for lapply.Rd with an R function.

ReadConfigFile(api, "tests/debug_config") terminates if the file has errors.
  try sliding in definition of exit() in Rexit/exit.c

  library(Rtesseract); api = tesseract();ReadConfigFile(api, "Experiments/bad_config")

tprintf() annd messages on console.

Be able to interrupt in OCR computations with Ctrl-c.

[Verify sane] Get alternatives is returning different output between:
library(Rtesseract)
f = system.file("images", "OCRSample2.png", package = "Rtesseract")
a = getAlternatives(f)

api = tesseract(f)
Recognize(api)
ri = as(api, "ResultIterator")
b = lapply(ri, getAlternatives, "word")
identical(a, b)

api = tesseract(f)
Recognize(api)
ri = as(api, "ResultIterator")
b = lapply(ri, getNativeSymbolInfo("getAlts"), "word")


[done] switch getAlternatives() method for TessBaseAPI to use ResultIterator method.

[yes] Does the ResultIterator get released?

Do we need to delete the choice object

[done] getAlternatives(ri) may not want to just get the alternatives for the current cursor in the iterator, but all of them.

[resolved] Additionally, seems to be returing alternatives at the wrong level (Returns a single letter, only the first letter) 
  Does ChoiceIterator() only work for characters/symbols, not words.
  - need to check that this is operating correctly.
   This is because we never call Next(), but lapply(ri, fun, level) does. And we have to specify the level here.

Test that output is the same and correct between ocr and getXXX functions.

Test that plot/other helper functions are still functioning with output from the getXXX functions.
Fix the names on the bounding boxes to be consistent within the package and with the PDF tables code.
Clean up ocr() so that the bounding box is returned, is consistent with that from BoundingBoxes
 and creates a data frame/matrix.

Update documentation/NAMESPACE to reflect current functions and functionality.

? Other methods form the baseapi.h ?

[can we reproduce this] seg fault in plotSubImage() when run via the examples.
  [Seems okay on OSX machine (DTL)]
  Could be an earlier example with memory issues appearing at this point.
  e.g. pixRead()

[done] ProcessPages in render.cpp

??Change the names of the functions to initial lower case, e.g. getInputName(), ?

[check] Rationalize tesseract() and Init() so can pass all the arguments through to Init()

[test] Have an option for SetInputName() to read the image and load it via SetImage().

[change name of function] How can we query whether we have to call Recognize() or not?
              hasRecognized() function - Change name
                 Ask for a ResultIterator and if it returns NULL, then call Recognize().


GetInputImage() - figure out how to convert the Pix to an array() in R 
     deal with the bits and mapping them back to what we expect from, e.g., readPNG(),
     [fixed] an array is returning 32 deep, whereas readPNG() is just 4.  The depth is in bits in Pix (leptonica).


[very low priority] Sort out the R renderer class.
  Why do we want to have our own?  If we have to use ProcessPages() we don't want to write to disk unnecessarily.


[don't make it accessible from the tesseract object]
  When we return a Pix, increase the reference count and put a finalizer to decrease it.
    The destroyPix  seems to be there.

[dont expose it to end-user] Also if we have a ResultIterator, don't let the tesseract instance die/
 ?Should we introduce  a sub-class of tesseract with which we can solve these and the already Recognize()d issues?

When tesseract complains below, raise an error.  Stop the output going to stdout/stderr
 (see tprintf_internal issue above. )
      The error messages run through tprintf_internal() in ccutil/tprinf.cpp.
      There is a debug_file that we can write to.  Set this and then read that file when there is an error. Very ugly.
      How do people do this in python, etc.
  Error opening data file /Users/duncan/Projects/OCR/tesseract-ocr/tessdata/osd.traineddata
  Please make sure the TESSDATA_PREFIX environment variable is set to the parent directory of your "tessdata" directory.
  Failed loading language 'osd'
  Tesseract couldn't load any languages!

 How do we regenerate this?
   Unset TESSDATA_PREFIX in ~/.cshrc and run Rtesseract.
       api = tesseract("inst/trainingSample/eng.tables.exp0.png", 0L)

 This is what did it - but not anymore.
  Sys.setenv(TESSDATA_PREFIX= path.expand("~/Projects/OCR/tesseract-ocr"))
  library(Rtesseract)
   api = tesseract("inst/trainingSample/eng.tables.exp0.png", 0L)
   Recognize(api)


Connect to OpenCV for manipulating the image.  perhaps thresholding away the specs. 
    https://github.com/swarm-lab/videoplayR
    https://code.google.com/archive/p/r-opencv/source/default/source


?? GetInputName seems to take an age (in some cases)!!  Did time it and got exactly 0.

?? plot.OCR() seems to be doing something unnecessary - an extra call to Recognize() somewhere?
   Seems okay.  rasterImage() and readPNG() do take time.

[done] create searchable pdf - use their renderer
  want to be able to fix the errors and then create it.
  Started in example in pdf.R and code in render.cpp.
     It generates a pdf but it cannot be opened.  
   Needed a finalizer on the R object to call the destructor to close the file.

[not really relevant] See MutableIterator for possibly modifying the tesseract content.
  This is just a live ResultIterator that has access to the contents of the TessBaseAPI so we could change them.

[okay now] Can't seem to open pdf config file - i.e., the one called pdf in /usr/local/share/tessdata/configs, but can find batch.nochop.

[check] 
With cropBoxes, can get negative indices.
  Change the margin.  Compute it so that it can't yield negative indices.

[Done] GetAlternatives - use getAlternatives
  Only returns one
  Segfaults.
  Look at the R_ocr_alternatives and see if we can reuse that code.
  Note that ocr(alternatives = TRUE) works.

compareWords() warns about different lengths. Something wrong? See MarkLundy/ocr.R
  Is this to be expected as the ocr and truth words may have different number of characters.
  Or think of other ways to compare them - adist?


[check] ocr() function using the API-level functions.
 ACTUALLY, just remove and use getAlternatives(), getConfidences(), getBoxes(), getText().
   i.e. implement not in C but in R code to assemble the different pieces.
   Can do now.

[Done] Plot the image and the components and show the confidence level for each  box
   See tests/plot.R

[Mostly done]   Color code the rectangles for the bboxes according to the confidence.

Annotate an SVG plot of this so that we can see the confidence levels and alternatives for a bbox.

[Feature Request] When find an error in the OCR, get the subset of the image for that bounding box and 
   then see if we can cluster them.
    Need to know if it is an error, so presumably need to know truth.
    Or instead of errors, just those values with low confidence.
    See inst/caseStudies

  Can do this from the bounding box information and reading the image using one of the R packages.

[ok] error rates and confusion matrix when know the actual values.

[low] Get components - leptonica objects Boxa and Pixa
   How about identifying lines.  Done in bounding box if we use psm_auto for PageSegmentationMode

[Check] Get alternatives via R interface to API, not the R_tesseract_ alternatives routine.
   Is this in the ocr() routine? e.g. ocr(, alternatives = TRUE)


---------------------
[done from NAMESPACE] remove the ocr() function
[done] readImage not being found in plot.OCR() - .Rbuildignore was causing it to be discard due to FUNS. Matching is case-insensitive.
[done] Document SetInputName, SetImage

[done] Remove GetIterator.Rd

[fixed] Segfaults if Recognize hasn't been called.
 library(Rtesseract)
 ts = tesseract(system.file("trainingSample", "eng.tables.exp0.png", package = "Rtesseract"))
 a = getAlternatives(ts)

[Fixed now] Investigate  "Calling Recognize again"
  library(Rtesseract)
  ts = tesseract(system.file("trainingSample", "eng.tables.exp0.png", package = "Rtesseract"))
  b = getBoxes(ts)



[done] SetInputName - if no api, warn don't treat file name as api.

[Doesn't do better] Use the cube - Init() with an engineMode

[Fixed] read_params_file
          read_params_file: Can't open NA

[Fixed] Why does cmd-line tesseract give a different set of words as ocr()
  What about 
    ts = tesseract(fs)
    getConfidences(ts)
    The PageSegMode was being reset in the API::Init() method and we were setting it before calling that.


[done] get information about the current image - dimensions, other info. See getImageInfo() & getImageDims()

[Done] See getConfidences() on a tessseract object.  Get the confidences separately from ocr().

[Done] Give a blank image (i.e. a file that contains nothing) and ocr() seg faults
   created via PDFBox w/o the jbig2-imageio in the classpath
   To create one, in DSIProjects/MarkMundy, 
      java -jar ~/Downloads/pdfbox-app-2.0.2.jar PDFToImage -outputPrefix test -imageType png 1982-128-44.pdf 

[Done] Check if we have support for a particular image based on its type.
  Check the supported leptonica image formats.

[Done] cropToBoxes = TRUE in plot.OCR - get it to work.

[Done] When Recognize() not called, don't seg fault in lapply().


[Done] SetVariable and GetVariable.
     tests/vars.R
     different types.

[Basic] configuration

[Done] capabilities  - at configure time.
  e.g. image formats leptonica understands.
   leptonicaImageFormats()

[Done] PrintVariables scan() problem.
    Error during wrapup: line 376 did not have 3 elements
    Yet
       tt = readLines(f)
       els = strsplit(tt, "\t")
       sapply(els, length)
p[fixed] If the file doesn't exist, get a weird  error message.

[Done] Make getCharWidth/Height ignore text with no content & just one space.
























Session generating error about not being able to read osd.traineddata.
 api = tesseract("inst/trainingSample/eng.tables.exp0.png")
17> .Call("R_TessBaseAPI_SetPageSegMode", api, 0L)
[1] TRUE
18> Recognize
*** output flushed ***
19> Recognize(api)
Error opening data file /Users/duncan/Projects/OCR/tesseract-ocr/tessdata/osd.traineddata
Please make sure the TESSDATA_PREFIX environment variable is set to the parent directory of your "tessdata" directory.
Failed loading language 'osd'
Tesseract couldn't load any languages!
Warning: Auto orientation and script detection requested, but osd language failed to load
[1] TRUE
20> .Call("R_TessBaseAPI_SetPageSegMode", api, 1L)
[1] TRUE
21> Recognize(api)
Error opening data file /Users/duncan/Projects/OCR/tesseract-ocr/tessdata/osd.traineddata
Please make sure the TESSDATA_PREFIX environment variable is set to the parent directory of your "tessdata" directory.
Failed loading language 'osd'
Tesseract couldn't load any languages!
Warning: Auto orientation and script detection requested, but osd language failed to load
[1] TRUE
22> .Call("R_TessBaseAPI_SetPageSegMode", api, 2L)
[1] TRUE




